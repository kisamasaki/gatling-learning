# Gatling
- Gatling Recorder
    - ブラウザでのユーザー操作を記録し、それをGatlingのシナリオコードに変換するためのレコーダー機能
- シナリオコード
    - 性能テストや負荷テストを実行するためのテストシナリオを記述するためのコード
- RecorderMode
    - Gatling Recorderがどのようなモードで動作するかを指定するための機能
        - HTTPプロキシモード
            - リアルタイムでのトラフィックのキャプチャに特化
        - HARコンバーターモード
            - あらかじめ取得したデータの解析に特化
- Gatlingは使用する際に静的リソースを除外する
    - 性能テストや負荷テストの焦点はアプリケーションの動的な部分に絞り込まれているため
    - CSS、JavaScript、画像ファイル等の静的リソースは通常、一度ダウンロードされるとキャッシュされ、再度のダウンロードが発生しない。つまり、静的リソースのダウンロード自体はリクエストの数や応答時間に大きな影響を与えない
- 動的な部分
    - ユーザー認証とセッション管理
    - フォーム入力とデータ送信
    - API呼び出し
    - セッション固有のデータ
- レポートで表示される"OK"と"KO"は、それぞれ成功したリクエスト（"OK"）と失敗したリクエスト（"KO"）を示す
    - OK (成功)
        - "OK"は、テストの実行中に成功したリクエスト数を表す。これは正常に完了し、期待通りの応答が返ってきたリクエストの数
    - KO (失敗)
        - "KO"は、テストの実行中に失敗したリクエスト数を表す。これには様々な原因が含まれる。例えば、タイムアウト、HTTPステータスコードが期待値と異なる、レスポンスの検証に失敗したなどが考えられる。
- Mavenを使用することでプロジェクトの管理やビルドプロセスの自動化が容易になり、Gatlingを含む依存関係の解決が効果的に行えるため、開発およびテストプロセスが効率的に進むことが期待される
```scala
package videogamedb

// Gatlingのコアライブラリを提供。主にシナリオやシミュレーションを作成する際に使用されるクラスやメソッドが含まれている
import io.gatling.core.Predef._

// GatlingでHTTPテストを作成するためのライブラリを提供。HTTPリクエストやレスポンスに関連するクラスやメソッドが含まれている。
import io.gatling.http.Predef._

// MyFirstTest という名前のテストクラスを Simulation トレイトを継承して定義。
// Gatlingのテストは通常、Simulation トレイトを継承して作成
// Simulation トレイトは、Gatlingフレームワークにおいて性能テストシナリオを定義するためのトレイトです。
// Gatlingの性能テストは、シミュレーションと呼ばれる単位で組織されます。
// シミュレーションは、テストの実行方法やシナリオの振る舞いを制御するためのコードを提供
// Simulation トレイトを使用すると、テストのエントリーポイントである setUp メソッドを実装し、シナリオやテストの設定を行うことが可能
class MyFirstTest extends Simulation{

  // リクエストがJSON形式のレスポンスを受け入れるように設定
  val httpProtocol = http.baseUrl("https://videogamedb.uk/api")
    .acceptHeader("application/json")

  // scenarioメソッドはこのシナリオの名前を "My First Test" に設定
  // Get all gamesはこのリクエストの名前でこの名前はテストのレポートやログで使用され、リクエストを一意に特定
  // Gatlingでは、1つのシナリオ内に複数のリクエストを定義することが可能
  val scn = scenario("My First Test")
    .exec(http("Get all games")
    .get("/videogame"))

  // テストの実行方法やシナリオの定義、負荷テストの設定などを指定
  // setUp メソッドは性能テストの主要な設定を行うためのメソッド。
  // inject メソッドは、シナリオに対してユーザーの注入方法を指定。
  // atOnceUsers(1) は、一度に1つのユーザーがテストを開始する設定を示しています。つまり、1つのユーザーがシナリオを実行。
  // protocols メソッドは、テスト対象のプロトコルに関する設定を指定します。この例では httpProtocol を指定
  // httpProtocol は事前に定義されたHTTPプロトコルの設定を含んでおり、これにはベースURLやAcceptヘッダーの設定が含まれている
  setUp(
    scn.inject(atOnceUsers(1))
  ).protocols(httpProtocol)

}
```
- Gatlingにおける check は、HTTPレスポンスからデータを抽出し、検証するためのメソッド
- Gatlingでは、トランザクションは exec メソッドを使用して定義され、テストのメインの構成単位となる。scenario 内で3つのトランザクションが定義されている
```scala
val scn = scenario("My Scenario")
  .exec(http("Request 1").get("/path1"))
  .pause(5)
  .exec(http("Request 2").post("/path2"))
  .pause(3)
  .exec(http("Request 3").put("/path3"))
```
- pauseメソッドはリクエスト間やアクション間に時間経過があることを模倣し、テストが現実の利用者の行動に近いものとなる。テストがアプリケーションに対してよりリアルな負荷をかけることができる。
- bodyString は、GatlingでHTTPレスポンスのボディを文字列として抽出するためのメソッド。一般的に、bodyString は主に応答の検証やデバッグの目的で使用される
```scala
.check(bodyString.saveAs("responseBody"))
```
- session
    - テストの実行中にデータを保持するためのコンテナ。セッションはテストの各ステップで変更され、データを保存したり、共有したりするために使用される
    - 下記ではHTTPリクエストが実行された結果から "gameName" という名前のJSONパスの値が抽出され、セッションに保存される。後続のアクションでこのデータを利用することが可能。
```scala
.exec(http("Get specific game")
  .get("/videogame/1")
  .check(jsonPath("$.name").saveAs("gameName")))
```
- contentTypeHeader
    - このヘッダーは主にクライアントがサーバーに送信するリクエストで使用され、サーバーに対してリクエスト本文のデータがどの種類のコンテンツであるかを通知する
- フィーダー
    - テストのデータ供給源であり、シナリオ内で使用されるデータを提供する。
    - Gatlingでは、CSVファイル、テキストファイル、シーケンシャルな数値などがデータフィーダーとして使用される
- Gatlingの csv フィーダーは、CSVファイルの最初の行を変数名として扱う。そのため、提供されたCSVデータの場合、最初の行（ヘッダー行）が変数名を定義しているため、この行はデータフィーダーによって自動的にスキップされる。
- sbt
    - sbt（Scala Build Tool）は、Scalaプロジェクトのビルド、テスト、および管理を行うためのツール
    - GatlingはScalaで書かれたプロジェクトで、ScalaとAkkaを使用して開発されており、sbt（Scala Build Tool）を使用してビルドされる。そのため、Gatlingを実行するためには、Scalaおよびsbtが必要
- jdk
    - Gatling自体はScalaで書かれているが、Gatlingがテストする対象のアプリケーションやサービスがJavaで書かれている場合、JDKが必要
    - Gatlingが実行される際には、JVM（Java Virtual Machine）が必要。JVMはJDKに含まれており、GatlingがScalaコードを実行する際に使用される。
    - GatlingがHTTPリクエストを送信する際にも、JDKの一部であるJavaの標準ライブラリが使用されることがある。HTTP通信やSSL証明書の処理など、Javaの標準機能を利用している。
# Scala
- Scalaにおいて、objectはクラスの特別な種類で、シングルトンオブジェクト（Singleton Object）とも呼ばれる。objectを使用することで、そのクラスの単一のインスタンスが自動的に生成され、そのインスタンスはプログラムの中で唯一のものとなる
- イテレータ（Iterator）
    - 要素の列挙や反復処理を行うためのオブジェクト
    - イテレータは、要素を逐次的に提供することができ、通常は次の要素が存在するかどうかを確認するメソッドも提供されている
    - next(): 次の要素を取得。このメソッドを呼び出すたびに、イテレータは次の要素に進む
    - hasNext(): 次の要素が存在するかどうかを確認する。存在する場合は true を、存在しない場合は false を返す
    - イテレータは反復処理を行うための一般的な手段であり、配列、リスト、セット、マップなどのコレクションや、ファイルの行、データベースのクエリ結果などさまざまなデータソースに適用される。
- Scala言語では、メソッドの最後に明示的な return を書かなくても、メソッドの最後の評価結果が自動的に返される。
- Scalaでは、メソッドの戻り値の型も省略可能だが、一般的には型を省略せずに宣言することが推奨されている